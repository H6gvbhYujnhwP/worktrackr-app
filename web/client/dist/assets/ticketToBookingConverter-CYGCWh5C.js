const k=e=>`BK-${e}`,S=e=>{switch(e==null?void 0:e.toLowerCase()){case"urgent":case"high":return"confirmed";case"medium":return"pending";case"low":return"pending";default:return"pending"}},a=e=>{var o,r;const n=((o=e.category)==null?void 0:o.toLowerCase())||"",t=((r=e.description)==null?void 0:r.toLowerCase())||"";return n.includes("electrical")||t.includes("electrical")?t.includes("inspection")||t.includes("safety")?"Electrical Safety Inspection":t.includes("socket")||t.includes("outlet")?"Socket Installation":t.includes("light")||t.includes("fitting")?"Light Fitting Installation":t.includes("fuse")||t.includes("box")?"Fuse Box Upgrade":t.includes("emergency")||t.includes("urgent")?"Emergency Call Out":t.includes("rewiring")||t.includes("rewire")?"Rewiring":"Electrical Service":n.includes("plumbing")||t.includes("plumbing")?t.includes("boiler")?"Boiler Service":t.includes("leak")?"Leak Repair":t.includes("bathroom")?"Bathroom Installation":t.includes("drain")||t.includes("block")?"Drain Unblocking":t.includes("emergency")||t.includes("urgent")?"Emergency Call Out":"Plumbing Service":e.category||"General Service"},h=e=>{var i;const n=a(e),t=((i=e.priority)==null?void 0:i.toLowerCase())||"medium";let r={"Electrical Safety Inspection":120,"Socket Installation":120,"Light Fitting Installation":120,"Fuse Box Upgrade":240,"Emergency Call Out":120,Rewiring:480,"Boiler Service":90,"Leak Repair":60,"Bathroom Installation":480,"Drain Unblocking":60,"Electrical Service":120,"Plumbing Service":90,"General Service":120}[n]||120;return(t==="urgent"||t==="high")&&(r=Math.max(60,r*.8)),Math.round(r)},y=(e,n)=>{var c;const t=a(e),o=((c=e.priority)==null?void 0:c.toLowerCase())||"medium",r=75,i=1.5;let s=Math.round(n/60*r);return(o==="urgent"||t.includes("Emergency"))&&(s=Math.round(s*i)),Math.max(80,s)},B=e=>{if(!e)return null;try{const n=new Date(e);return isNaN(n.getTime())?null:{date:n.toISOString().split("T")[0],startTime:n.toTimeString().substring(0,5),endTime:null}}catch(n){return console.error("Error parsing scheduled date:",n),null}},T=(e,n)=>{try{const[t,o]=e.split(":").map(Number),r=new Date;return r.setHours(t,o,0,0),new Date(r.getTime()+n*6e4).toTimeString().substring(0,5)}catch(t){return console.error("Error calculating end time:",t),e}},m=e=>{var l,u,g,d;if(!e||!e.scheduled_date)return null;const n=B(e.scheduled_date);if(!n)return null;const t=h(e),o=T(n.startTime,t),r=a(e),i=y(e,t),s=((l=e.contactDetails)==null?void 0:l.companyName)||e.customer_name||e.title||"Unknown Customer",c=((u=e.contactDetails)==null?void 0:u.phone)||e.customer_phone||"No phone provided",p=((g=e.contactDetails)==null?void 0:g.email)||e.customer_email||"No email provided",f=((d=e.contactDetails)==null?void 0:d.fullAddress)||e.location||e.address||"Location to be confirmed";return{id:k(e.id),ticketId:e.id,customerName:s,customerPhone:c,customerEmail:p,service:r,date:n.date,startTime:n.startTime,endTime:o,duration:t,location:f,status:S(e.priority),price:i,notes:e.description||"Generated from ticket",invoiceStatus:"not_created",createdFromTicket:!0,lastUpdated:new Date().toISOString()}},b=e=>Array.isArray(e)?e.map(m).filter(n=>n!==null):[],I=()=>{try{const e=JSON.parse(localStorage.getItem("tickets")||"[]"),n=b(e),r=[...JSON.parse(localStorage.getItem("ticketBookings")||"[]").filter(i=>!i.createdFromTicket),...n];return localStorage.setItem("ticketBookings",JSON.stringify(r)),console.log(`Synced ${n.length} ticket bookings to calendar`),n}catch(e){return console.error("Error syncing tickets to booking calendar:",e),[]}},v=e=>{try{const t=JSON.parse(localStorage.getItem("ticketBookings")||"[]").filter(o=>o.ticketId!==e);localStorage.setItem("ticketBookings",JSON.stringify(t)),console.log(`Removed booking for ticket ${e}`)}catch(n){console.error("Error removing ticket booking:",n)}},E=e=>{try{if(v(e.id),e.scheduled_date){const n=m(e);if(n){const t=JSON.parse(localStorage.getItem("ticketBookings")||"[]");t.push(n),localStorage.setItem("ticketBookings",JSON.stringify(t)),console.log(`Updated booking for ticket ${e.id}`)}}}catch(n){console.error("Error updating ticket booking:",n)}};export{m as convertTicketToBookingEvent,b as convertTicketsToBookingEvents,v as removeTicketBooking,I as syncTicketsToBookingCalendar,E as updateTicketBooking};
